{% load bootstrap5 %}

<div>
    <div id="answers">
        <div>
            <p>{{ answers|length }} Respostas</p>
        </div>
        {% for answer in answers %}
            <div id="answer-{{ answer.id }}" class="d-flex justify-content-between border border-dark my-3">
                <div>
                    <p>{{ answer.user.get_full_name }}</p>
                    <p>{{ answer.updated }}</p>
                    <p>{{ answer.content }}</p>
                </div>
                {% if answer.user == request.user %}
                    <div class="dropdown">
                        <span data-bs-toggle="dropdown">
                            <i class="bi bi-three-dots-vertical"></i>
                        </span>
                        <ul class="dropdown-menu">
                            <li>
                                <span class="dropdown-item">
                                    Editar
                                </span>
                            </li>
                            <li>
                                <span class="dropdown-item">
                                    Apagar
                                </span>
                            </li>
                        </ul>
                    </div>
                {% endif %}
            </div>
        {% endfor %}
        <div id="answer-question">
            {% csrf_token %}
            {% bootstrap_form form %}
            {% buttons %}
                <button id="send" class="btn btn-dark">Responder</button>
            {% endbuttons %}
        </div>
    </div>
</div>

{% block javascript %}
    <script>
        document.getElementById('send').addEventListener('click', () => {
            let question_id = "{{ question.id }}"
            let form = document.querySelector('#answer-question')
            let inputs = form.querySelectorAll('input, textarea')
            let values = {}
            inputs.forEach(input => {
                values[input.name] = input.value
            })
            htmx.ajax('POST', `/course/answer/create/${question_id}/`, {
                target: '#answers',
                values: values
            })
        })
    </script>
{% endblock %}