{% extends 'base.html' %}

{% load static %}

{% block title %}
    {{ course.title }}
{% endblock %}

{% block nav %}
    {% include 'partials/base/nav_lesson.html' %}
{% endblock %}

{% block content %}
    <div class="grid grid-cols-4">
        <div class="col-span-3">
            <div id="video">
                {% include 'hx/lesson/video.html' %}
            </div>
            <div id="menu" class="mx-10 items-center font-semibold text-lg pt-2">
                {% include 'partials/lesson/menu.html' %}
                <hr>
            </div>
            <div id="content">
            </div>
        </div>
        <div>
            {% include 'partials/lesson/accordion.html' %}
        </div>
    </div>
    {#    <div id="modal-note">#}
    {#        {% include 'hx/modal_note.html' %}#}
    {#    </div>#}
    {#    <div id="modal-confirm">#}
    {#        {% include 'hx/modal_confirm.html' %}#}
    {#    </div>#}
    {{ course.id|json_script:'course_id' }}
{% endblock %}

{% block javascript %}
    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="{% static 'js/lesson-events.js' %}"></script>
    <script src="{% static 'js/custom-form.js' %}"></script>
    <script src="{% static 'js/lesson-modal.js' %}"></script>
    <script src="{% static 'js/custom-error.js' %}"></script>
    <script>
        const formatTime = seconds => {
            const pad = num => num < 10 ? `0${num}` : num

            const H = pad(Math.floor(seconds / 3600))
            const i = pad(Math.floor(seconds % 3600 / 60))
            const s = pad(seconds % 60)

            let result = ''
            if (H > 0) result += `${+H}:`
            result += `${H > 0 ? i : +i}:${s}`
            return result.split('.')[0]
        }

        var player

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                events: {
                    'onStateChange': onPlayerStateChange,
                }
            })
        }

        function onPlayerStateChange(event) {
            if (event.data === YT.PlayerState.PLAYING) {
                var timer = setInterval(function () {
                    let result = formatTime(player.getCurrentTime())
                    let element = document.querySelector('#youtube-counter')
                    if (element) {
                        element.innerText = result
                        let counter = document.querySelector('#time-counter')
                        if (counter)
                            counter.setAttribute('value', result)
                    }
                }, 200);
            } else {
                clearInterval(timer);
            }
        }
    </script>
    <script src="{% static 'js/lesson-player.js' %}"></script>
{% endblock %}
