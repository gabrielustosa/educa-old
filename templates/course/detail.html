{% extends 'base.html' %}

{% load course_filter %}

{% block title %}
    {{ course.title }} | Educa
{% endblock %}

{% block nav %}
    {% include 'partials/base/nav_home.html' %}
{% endblock %}

{% block content %}
    <section>
        <div class="bg-zinc-800 w-full">
            <div class="grid grid-cols-3">
                <div class="col-span-2 p-10 pl-28">
                    <a href="{% url 'subject:view' course.subject.id %}" class="text-violet-300 font-semibold">
                        {{ course.subject.title }}
                    </a>
                    <h3 class="pt-3 text-white text-3xl font-bold">
                        {{ course.title }}
                    </h3>
                    <p class="pt-3 text-white text-lg font-bold">
                        {{ course.short_description }}
                    </p>
                    <div class="flex space-x-3 pt-3">
                        <span class="text-yellow-300">{{ course.get_rating_avg|floatformat }}</span>
                        {% for r in course.get_rating_avg|get_rating_stars %}
                            {% if r == "i" %}
                                <i class="text-yellow-300 w-2 h-2 bi bi-star-fill"></i>
                            {% elif r == "m" %}
                                <i class="text-yellow-300 w-2 h-2 bi bi-star-half"></i>
                            {% endif %}
                        {% endfor %}
                        <span class="pl-3 text-gray-500">
                            (<a href="#rating" class="text-violet-300 underline">{{ course.ratings.all|length }} avaliações</a>)
                        </span>
                        <span class="text-white">
                            {{ course.students.all|length }} alunos
                        </span>
                    </div>
                    <p class="text-white pt-2">Criado por
                        <span class="text-violet-300 underline">{{ course.owner.get_full_name }}</span>
                    </p>
                </div>
                <div class="relative">
                    <div class="absolute pt-10">
                        <img src="{{ course.image.url }}"
                             alt="Imagem do curso {{ course.title }}"
                             class="object-contain">
                        <div class="shadow-lg pb-3">
                            <div>{% if request.user|student_is_enrolled:course.id %}
                                {% with current_lesson=request.user|get_current_lesson:course %}
                                    <a href="{% url 'student:view' course.id current_lesson %}">
                                        <div class="flex justify-center">
                                            <button class="w-9/12 bg-violet-700 px-4 py-2 my-3 rounded-sm text-white">
                                                Acessar
                                            </button>
                                        </div>
                                    </a>
                                {% endwith %}
                            {% else %}
                                <form method="post" action="{% url 'student:enroll' course.id %}">
                                    {% csrf_token %}
                                    <div class="flex justify-center">
                                        <button class="w-9/12 bg-violet-700 px-4 py-2 my-3 rounded-sm text-white">
                                            Inscrever-se
                                        </button>
                                    </div>
                                </form>
                            {% endif %}
                            </div>
                            <div>
                                <h5 class="font-bold pt-3">Este curso inclui:</h5>
                                <ul class="pl-5 py-3 space-y-2">
                                    <li class="flex">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                             fill="currentColor" class="bi bi-person-video" viewBox="0 0 16 16">
                                            <path d="M8 9.05a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z"></path>
                                            <path d="M2 2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H2Zm10.798 11c-.453-1.27-1.76-3-4.798-3-3.037 0-4.345 1.73-4.798 3H2a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1h-1.202Z"></path>
                                        </svg>
                                        <span class="pl-3">{{ course.get_total_lessons }} Aulas sob demanda</span>
                                    </li>
                                    <li class="flex">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                             fill="currentColor" class="bi bi-cloud-arrow-down" viewBox="0 0 16 16">
                                            <path fill-rule="evenodd"
                                                  d="M7.646 10.854a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0-.708-.708L8.5 9.293V5.5a.5.5 0 0 0-1 0v3.793L6.354 8.146a.5.5 0 1 0-.708.708l2 2z"></path>
                                            <path d="M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"></path>
                                        </svg>
                                        <span class="pl-3">{{ course.get_total_files_download }} Arquivos para download</span>
                                    </li>
                                    <li class="flex">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                             fill="currentColor" class="bi bi-infinity" viewBox="0 0 16 16">
                                            <path d="M5.68 5.792 7.345 7.75 5.681 9.708a2.75 2.75 0 1 1 0-3.916ZM8 6.978 6.416 5.113l-.014-.015a3.75 3.75 0 1 0 0 5.304l.014-.015L8 8.522l1.584 1.865.014.015a3.75 3.75 0 1 0 0-5.304l-.014.015L8 6.978Zm.656.772 1.663-1.958a2.75 2.75 0 1 1 0 3.916L8.656 7.75Z"></path>
                                        </svg>
                                        <span class="pl-3">Acesso vitalício</span>
                                    </li>
                                    <li class="flex">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                             fill="currentColor" class="bi bi-trophy" viewBox="0 0 16 16">
                                            <path d="M2.5.5A.5.5 0 0 1 3 0h10a.5.5 0 0 1 .5.5c0 .538-.012 1.05-.034 1.536a3 3 0 1 1-1.133 5.89c-.79 1.865-1.878 2.777-2.833 3.011v2.173l1.425.356c.194.048.377.135.537.255L13.3 15.1a.5.5 0 0 1-.3.9H3a.5.5 0 0 1-.3-.9l1.838-1.379c.16-.12.343-.207.537-.255L6.5 13.11v-2.173c-.955-.234-2.043-1.146-2.833-3.012a3 3 0 1 1-1.132-5.89A33.076 33.076 0 0 1 2.5.5zm.099 2.54a2 2 0 0 0 .72 3.935c-.333-1.05-.588-2.346-.72-3.935zm10.083 3.935a2 2 0 0 0 .72-3.935c-.133 1.59-.388 2.885-.72 3.935zM3.504 1c.007.517.026 1.006.056 1.469.13 2.028.457 3.546.87 4.667C5.294 9.48 6.484 10 7 10a.5.5 0 0 1 .5.5v2.61a1 1 0 0 1-.757.97l-1.426.356a.5.5 0 0 0-.179.085L4.5 15h7l-.638-.479a.501.501 0 0 0-.18-.085l-1.425-.356a1 1 0 0 1-.757-.97V10.5A.5.5 0 0 1 9 10c.516 0 1.706-.52 2.57-2.864.413-1.12.74-2.64.87-4.667.03-.463.049-.952.056-1.469H3.504z"></path>
                                        </svg>
                                        <span class="pl-3">Certificado de conclusão</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="grid grid-cols-3">
            <div class="mx-16 col-span-2">
                <div class="my-7">
                    <h1 class="p-5 text-2xl font-bold">O que você aprenderá</h1>
                    <p class="pl-5 py-5">
                        {{ course.learn_description }}
                    </p>
                </div>
                <div class="my-7 p-5">
                    <h1 class="text-2xl font-bold">Conteúdo do curso</h1>
                    <div class="pt-8 text-sm">
                        {{ course.modules.all|length }} módulos • {{ course.lesson_set.all|length }} aulas
                        <div class="pt-5">
                            {% for module in course.modules.all %}
                                <div id="accordion-collapse" data-accordion="collapse">
                                    <div>
                                        <button type="button"
                                                class="flex items-center p-3 text-lg w-full text-left border border-gray-200 focus:ring-4 focus:ring-gray-200"
                                                data-accordion-target="#accordion-module-{{ module.id }}">
                                            <svg data-accordion-icon class="w-6 h-6 shrink-0" fill="currentColor"
                                                 viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                                <path fill-rule="evenodd"
                                                      d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                      clip-rule="evenodd">
                                                </path>
                                            </svg>
                                            <span class="grid grid-cols-2 content-between w-full">
                                                <span class="pl-3 text-black">{{ module.title }}</span>
                                                <span class="text-black text-right">{{ module.lessons.all|length }} aulas</span>
                                            </span>
                                        </button>
                                    </div>
                                    <div id="accordion-module-{{ module.id }}" class="hidden">
                                        <div class="p-5 border border-t-0 border-gray-200 dark:border-gray-700">
                                            {% for lesson in module.lessons.all %}
                                                <div class="text-base flex py-2">
                                                    <i class="bi bi-play-circle-fill"></i>
                                                    <p class="pl-3">Aula {{ lesson.order }} - {{ lesson.title }}</p>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <div class="my-7">
                    <h1 class="p-5 text-2xl font-bold">Requisitos</h1>
                    <p class="pl-5 py-5">
                        {{ course.requirements }}
                    </p>
                </div>
                <div class="my-7">
                    <h1 class="p-5 text-2xl font-bold">Descrição</h1>
                    <p class="pl-5 py-5">
                        {{ course.requirements }}
                    </p>
                </div>
                <div id="rating" class="pl-5">
                    <h1 class="text-3xl font-bold">Feedback dos alunos</h1>
                    <div class="grid grid-cols-3">
                        <div class="py-3">
                            <h1 class="text-6xl text-center font-bold text-yellow-600">{{ course.get_rating_avg }}</h1>
                            <div class="flex justify-center py-2 space-x-3">
                                {% for r in course.get_rating_avg|get_rating_stars %}
                                    {% if r == "i" %}
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                             fill="currentColor" class="text-yellow-300 bi bi-star-fill"
                                             viewBox="0 0 16 16">
                                            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"></path>
                                        </svg>
                                    {% elif r == "m" %}
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                             fill="currentColor" class="text-yellow-300 bi bi-star-half"
                                             viewBox="0 0 16 16">
                                            <path d="M5.354 5.119 7.538.792A.516.516 0 0 1 8 .5c.183 0 .366.097.465.292l2.184 4.327 4.898.696A.537.537 0 0 1 16 6.32a.548.548 0 0 1-.17.445l-3.523 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256a.52.52 0 0 1-.146.05c-.342.06-.668-.254-.6-.642l.83-4.73L.173 6.765a.55.55 0 0 1-.172-.403.58.58 0 0 1 .085-.302.513.513 0 0 1 .37-.245l4.898-.696zM8 12.027a.5.5 0 0 1 .232.056l3.686 1.894-.694-3.957a.565.565 0 0 1 .162-.505l2.907-2.77-4.052-.576a.525.525 0 0 1-.393-.288L8.001 2.223 8 2.226v9.8z"></path>
                                        </svg>
                                    {% endif %}
                                {% endfor %}
                            </div>
                            <p class="text-yellow-600 text-center text-lg">Avaliação do curso</p>
                        </div>
                        <div class="col-span-2 pt-3 space-y-2">
                            {% for k, v in course.get_rating_bars.items %}
                                <div class="grid grid-cols-2 items-center">
                                    <div class="h-4 bg-gray-200 rounded-full dark:bg-gray-700">
                                        <div class="h-4 bg-gray-600 rounded-full dark:bg-gray-300"
                                             style="width: {{ v }}%"></div>
                                    </div>
                                    <div>
                                        <div class="flex pl-3">
                                            {% for r in k|get_rating_stars_empty %}
                                                {% if r == "i" %}
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                         fill="currentColor" class="text-yellow-300 bi bi-star-fill"
                                                         viewBox="0 0 16 16">
                                                        <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"></path>
                                                    </svg>
                                                {% elif r == "v" %}
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                         fill="currentColor" class="text-yellow-300 bi bi-star"
                                                         viewBox="0 0 16 16">
                                                        <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"></path>
                                                    </svg>
                                                {% endif %}
                                            {% endfor %}
                                            <div>
                                                <span class="pl-5 text-violet-500">{{ v|floatformat }} %</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="pt-8 w-8/12">
                        <h1 class="text-3xl font-bold pb-10">Avaliações</h1>
                        <div>
                            {% for rating in ratings %}
                                <div class="py-4">
                                    <h1 class="text-lg font-bold">{{ rating.user.get_full_name }}</h1>
                                    <div class="flex pt-2">
                                        <div class="flex">
                                            {% for r in rating.rating|get_rating_stars %}
                                                {% if r == "i" %}
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                                         fill="currentColor" class="text-yellow-500 bi bi-star-fill"
                                                         viewBox="0 0 16 16">
                                                        <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"></path>
                                                    </svg>
                                                {% elif r == "m" %}
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                                         fill="currentColor" class="text-yellow-500 bi bi-star-half"
                                                         viewBox="0 0 16 16">
                                                        <path d="M5.354 5.119 7.538.792A.516.516 0 0 1 8 .5c.183 0 .366.097.465.292l2.184 4.327 4.898.696A.537.537 0 0 1 16 6.32a.548.548 0 0 1-.17.445l-3.523 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256a.52.52 0 0 1-.146.05c-.342.06-.668-.254-.6-.642l.83-4.73L.173 6.765a.55.55 0 0 1-.172-.403.58.58 0 0 1 .085-.302.513.513 0 0 1 .37-.245l4.898-.696zM8 12.027a.5.5 0 0 1 .232.056l3.686 1.894-.694-3.957a.565.565 0 0 1 .162-.505l2.907-2.77-4.052-.576a.525.525 0 0 1-.393-.288L8.001 2.223 8 2.226v9.8z"></path>
                                                    </svg>
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                        <div>
                                            <span class="pl-5 text-gray-500"> {{ rating.created }}</span>
                                        </div>
                                    </div>
                                    <p class="text-sm py-2">{{ rating.comment }}</p>
                                </div>
                                <hr class="border-gray-400">
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}